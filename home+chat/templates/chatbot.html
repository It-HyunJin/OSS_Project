<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" >
    <title>Í∞êÏ†ï ÎßêÌïòÍ∏∞ü§ó</title>
    
    <style type="text/css">
        h1{text-align: center;}
        nav ul{list-style-type: none;text-align:center; font-size: 15pt; }
        nav ul li{display: inline; margin: 70px; padding: 8px;}
        nav ul li a{text-decoration-line: none;color: black;}
        ul li a:visited{color:black;}
        ul li a:hover{color: black; font-size: 20pt;}
        .pos{text-align: center;}

        <style>
      .chatheader {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        padding: 10px 0;
        background-color: ;
        color: #000;
        text-align: center;
      }
      .chatfooter {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        padding: 10px 0;
        background-color: #FFF;
        color: #000;
        text-align: center;
      }
    </style>

    <script>
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
      }

      function sendMe() {
        var ctext = document.getElementById("chattext").value;
        if (ctext == "") {
          document.getElementById("chattext").focus();
          return false;
        }
        var addtext = "<div style='margin:14px 14px;text-align:right;'><span style='background-color:#FBDEA2; padding:5px 8px;border-radius:3px;'>" + ctext + "</span></div>";
        document.getElementById("chatbox").innerHTML += addtext;
        var mydiv = document.getElementById("chatbox");
        mydiv.scrollTop = document.getElementById("chatbox").scrollHeight;

        fetch('/chat-response/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': getCookie('csrftoken')
          },
          body: 'user_input=' + encodeURIComponent(ctext)
        })
        .then(response => response.json())
        .then(data => {
          var bottext = "<div style='margin:14px 14px;text-align:left;'><span style='background-color:#FBFBEF; padding:5px 8px;border-radius:3px;'>" + data.response + "</span></div>";
          document.getElementById("chatbox").innerHTML += bottext;
          var mydiv = document.getElementById("chatbox");
        mydiv.scrollTop = document.getElementById("chatbox").scrollHeight;
        });

        document.getElementById("chattext").value = "";
      }
    </script>
</head>
<body style="background-color:#FFF;">
   <header><h1>Í∞êÏ†ï ÎåÄÌôîü§ó</h1></header><hr>
    <nav>
        <ul>
          <li><a href="{% url 'home' %}"> ÌôàÏúºÎ°ú </a></li>
          <li><a href="{% url 'diary' %}">Ïò§ÎäòÏùò ÏùºÍ∏∞</a></li>
        </ul>
    </nav><hr>
    <article style="height:100%;">
      <div style="height:550px;margin-top:55px;background-color:#82B695;overflow-y:scroll;overflow-x:hidden;max-height:60vh;" id="chatbox"></div>
      <div class="chatfooter">
          <table width="100%">
              <tr>
                  <td width="85%" align="left">
                      <input type="text" id="chattext" style="padding:10px 0; width:100%; border:solid 0px #000">
                    </td> 
                  <td width="15%" align="right">
                      <button style="padding:10px 0; width:100%" onclick="sendMe()" id="sendbtn">Ï†ÑÏÜ°</button>
                  </td> 
              </tr>
          </table>
      </div>
    </article>
    
</body>
</html>
<script>
  var input = document.getElementById("chattext");

  input.addEventListener("keyup", function(event) {
    if (event.keyCode === 13){
      document.getElementById("sendbtn").click();
    }
  });
</script>